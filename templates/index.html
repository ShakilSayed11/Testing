<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Management</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: green;
            color: white;
        }
        td.editable {
            background-color: #f0f8ff;
        }
    </style>
</head>
<body>
    <h1>Attendance Management</h1>
    <table id="attendance-table">
        <tr>
            {% for header in data[0].keys() %}
                <th>{{ header.replace('_', ' ') }}</th>
            {% endfor %}
        </tr>
        {% for row in data %}
            <tr>
                {% for key, value in row.items() %}
                    <td class="{{ 'editable' if key == current_date else '' }}" contenteditable="{{ 'true' if key == current_date else 'false' }}"
                        data-id="{{ row['id'] }}" data-column="{{ key }}">
                        {{ value }}
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>
    <script>
        document.querySelectorAll('td.editable').forEach(cell => {
            cell.addEventListener('blur', async () => {
                const id = cell.getAttribute('data-id');
                const dateColumn = cell.getAttribute('data-column');
                const newValue = cell.textContent;

                const response = await fetch('/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        id: id,
                        date_column: dateColumn,
                        new_value: newValue,
                    })
                });

                const result = await response.json();
                if (result.status !== 'success') {
                    alert('Error updating attendance: ' + result.message);
                }
            });
        });
    </script>
</body>
</html>
