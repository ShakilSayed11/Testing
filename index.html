<!DOCTYPE html>
<html>
<head>
    <title>Google Sheets Data Display</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <style>
        :root {
    /* Updated Color Palette with Gradients */
    --primary-color: linear-gradient(45deg, #26c6da, #1a8fbd);
    --secondary-color: linear-gradient(45deg, #ec407a, #d81b60);
    --background-color: #121212; /* Darker Gray */
    --card-background: #1e1e1e; /* Dark Gray */
    --text-color: #ffffff;
    --accent-color: #ffeb3b;
    --border-radius: 12px;
    --secondary-font: 'Roboto', sans-serif;
    --input-focus-color: #34a7c1; /* A lighter shade of primary color for focus */
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    margin: 0;
    padding: 20px;
    line-height: 1.6;
}

.container {
    max-width: 100%;
    margin: auto;
    padding: 20px;
    text-align: center;
}

header {
    color: var(--primary-color);
    margin-bottom: 20px;
    font-weight: bold;
}

.card {
    background: var(--card-background);
    padding: 20px;
    border-radius: var(--border-radius);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    margin-bottom: 20px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
}

#filters {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

#filters input {
    padding: 10px;
    border: 2px solid transparent;
    background-color: var(--card-background);
    color: var(--text-color);
    border-radius: var(--border-radius);
    transition: background-color 0.3s, border-color 0.3s;
}

#filters input:focus {
    background-color: var(--input-focus-color);
    border-color: var(--secondary-color);
    outline: none;
    color: var(--text-color);
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    table-layout: auto;
    text-align: center;
}

th, td {
    padding: 15px;
    border-bottom: 1px solid #444;
}

th {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    background-color: var(--primary-color);
    color: white;
}
td:hover {
    background-color: var(--secondary-color);
    color: white;
}

tr:nth-child(even) {
    background-color: var(--card-background);
}

#pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}


/* Style for Pagination Input Bar */
#pagination #recordsPerPage {
    background-color: var(--card-background);
    border: 2px solid var(--primary-color);
    color: var(--text-color);
    padding: 10px;
    border-radius: var(--border-radius);
    transition: border-color 0.3s;
}

#pagination #recordsPerPage:focus {
    border-color: var(--secondary-color);
    outline: none;
}

#pagination button {
    background-color: var(--primary-color);
    color: var(--text-color);
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.3s;
}

#pagination button:hover {
    background-color: var(--secondary-color);
    transform: scale(1.1);
}

@media (max-width: 768px) {
    #filters {
        grid-template-columns: repeat(2, 1fr);
    }

    table, th, td {
        font-size: 14px;
    }
}

/* CSS */
.button-30 {
  align-items: center;
  appearance: none;
  background-color: #FCFCFD;
  border-radius: 4px;
  border-width: 0;
  box-shadow: rgba(45, 35, 66, 0.4) 0 2px 4px,rgba(45, 35, 66, 0.3) 0 7px 13px -3px,#D6D6E7 0 -3px 0 inset;
  box-sizing: border-box;
  color: #36395A;
  cursor: pointer;
  display: inline-flex;
  font-family: "JetBrains Mono",monospace;
  height: 40px;
  justify-content: center;
  line-height: 1;
  list-style: none;
  overflow: hidden;
  padding-left: 16px;
  padding-right: 16px;
  position: relative;
  text-align: left;
  text-decoration: none;
  transition: box-shadow .15s,transform .15s;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  white-space: nowrap;
  will-change: box-shadow,transform;
  font-size: 18px;
  margin-left: 1400px;
  margin-top: 10px;
}

.button-30:focus {
  box-shadow: #fefeff 0 0 0 1.5px inset, rgba(45, 35, 66, 0.4) 0 2px 4px, rgba(45, 35, 66, 0.3) 0 7px 13px -3px, #D6D6E7 0 -3px 0 inset;
}

.button-30:hover {
  box-shadow: rgba(255, 255, 255, 0.4) 0 4px 8px, rgba(45, 35, 66, 0.3) 0 7px 13px -3px, #D6D6E7 0 -3px 0 inset;
  transform: translateY(-2px);
}

.button-30:active {
  box-shadow: #ffffff 0 3px 7px inset;
  transform: translateY(2px);
}




    /* Additional Navbar Styles */
    .navbar {
        background-color: var(--primary-color);
        color: var(--text-color);
        padding: 10px 0;
    }

    .navbar-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .navbar-logo {
        font-size: 24px;
        text-decoration: none;
        color: var(--text-color);
        font-weight: bold;
    }

    .navbar-links {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
    }

    .nav-link {
        margin-right: 20px;
        text-decoration: none;
        color: var(--text-color);
        font-weight: bold;
        transition: color 0.3s ease;
    }

    .nav-link:hover {
        color: var(--accent-color);
    }
    </style>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="navbar-content">
            <a href="#" class="navbar-logo">Google Sheets Data Display</a>
            <ul class="navbar-links">
                <li><a href="#" class="nav-link">Home</a></li>
                <li><a href="#" class="nav-link">Reports</a></li>
            </ul>
        </div>
    </div>
    <div id="filters">
        <input type="text" id="filterDate" placeholder="Filter by Date">
        <input type="text" id="filterAgent" placeholder="Filter by Agent Name">
        <input type="text" id="filterVertical" placeholder="Filter by Vertical">
        <input type="text" id="filterRegion" placeholder="Filter by Region">
    </div>

    <div id="pagination">
        <button id="prevPage">Previous</button>
        <span id="pageInfo"></span>
        <button id="nextPage">Next</button>
        <input type="number" id="recordsPerPage" placeholder="Records per Page" value="10">
    </div>
    <table id="sheetTable">
        <thead>
            <tr>
                <th>Agent Name</th>
                <th>Working Department</th>
                <th>Working Region</th>
                <th>Ticket Number</th>
                <th>Student ID</th>
                <th>Task Date</th>
                <th>Email Time</th>
                <th>Task Name</th>
                <th>Task Time</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Data rows will go here -->
        </tbody>
    </table>
    <button class="button-30" role="button" id="downloadExcel">Download Report</button>


    <script>
        function decodeIP(encodedIP) {
            return encodedIP.split('').reverse().join('');
        }

        function checkAccess() {
            return new Promise((resolve, reject) => {
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        const userIP = data.ip;
                        const encodedIPs = ['702.92.921.051','601.02.721.301','92.032.84.281','201.59.971.202',"7.032.84.281","091.0.85.251","991.412.84.281","11.55.511.54","95.532.221.301","902.79.891.301",'0.4.85.251','231.671.97.411','971.4.85.251','151.102.171.301','741.79.891.301']; 
                        const decodedIPs = encodedIPs.map(ip => decodeIP(ip));

                        if (decodedIPs.includes(userIP)) {
                            resolve();
                        } else {
                            reject('Access Denied - Admin has been Notified. Thanks!!<br><br>For seeking access please connect with Shakil Sayed.');

                        }
                    })
                    .catch(error => {
                        console.error('Error fetching IP:', error);
                        reject('Error checking access');
                    });
            });
        }

        // Function to initialize the page
        function initializePage() {
            const apiKey = 'AIzaSyAWVybWDvIA9Xiic2z3uoat4V1ymFshW7s'; // Replace with your actual API key
            const sheetId = '1gcsBvEoHAhlhM0WWIXpF5TbfRua-wWWqL7ykySy9fDk'; // Replace with your actual sheet ID
            const range = 'A:Z';

            let fullData = [];
            let currentPage = 1;
            const defaultRecordsPerPage = 50;

            function fetchData() {
                fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`)
                    .then(response => response.json())
                    .then(data => {
                        fullData = data.values.slice(1); // Exclude header row
                        updateDisplay();
                    })
                    .catch(error => {
                        console.error('Error fetching data: ', error);
                    });
            }

    function updateDisplay() {
        const filterDate = document.getElementById('filterDate').value.toLowerCase();
        const filterAgent = document.getElementById('filterAgent').value.toLowerCase();
        const filterVertical = document.getElementById('filterVertical').value.toLowerCase();
        const filterRegion = document.getElementById('filterRegion').value.toLowerCase();

        const filteredData = fullData.filter(row => {
            return (filterDate === '' || row[5].toLowerCase().includes(filterDate)) &&
                   (filterAgent === '' || row[0].toLowerCase().includes(filterAgent)) &&
                   (filterVertical === '' || row[1].toLowerCase().includes(filterVertical)) &&
                   (filterRegion === '' || row[2].toLowerCase().includes(filterRegion));
        });

        const recordsPerPage = parseInt(document.getElementById('recordsPerPage').value) || defaultRecordsPerPage;
        const startIndex = (currentPage - 1) * recordsPerPage;
        const endIndex = startIndex + recordsPerPage;
        const paginatedData = filteredData.slice(startIndex, endIndex);

        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';
        paginatedData.forEach(row => {
            const html = `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`;
            tableBody.innerHTML += html;
        });

        document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${Math.ceil(filteredData.length / recordsPerPage)}`;
    }

    document.querySelectorAll('#filters input').forEach(input => {
        input.addEventListener('input', () => {
            currentPage = 1;
            updateDisplay();
        });
    });

    document.getElementById('prevPage').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            updateDisplay();
        }
    });

    document.getElementById('nextPage').addEventListener('click', () => {
        currentPage++;
        updateDisplay();
    });

    document.getElementById('recordsPerPage').addEventListener('change', () => {
        currentPage = 1;
        updateDisplay();
    });

    fetchData();
            setInterval(fetchData, 30000);

            document.getElementById('downloadExcel').addEventListener('click', function() {
                var table = document.getElementById('sheetTable');
                var workbook = XLSX.utils.table_to_book(table);
                XLSX.writeFile(workbook, 'TableData.xlsx');
            });
        }

        // Check user's IP and initialize the page if access is granted
        document.addEventListener('DOMContentLoaded', function() {
            checkAccess().then(() => {
                initializePage();
            }).catch(message => {
                document.body.innerHTML = `<h1>${message}</h1>`;
            });
        });
    </script>
</body>
</html>
